<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Networking - The Nimbus Beacon Chain Book</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="philosophy.html"><strong aria-hidden="true">2.</strong> Design goals</a></li><li class="chapter-item expanded "><a href="hardware.html"><strong aria-hidden="true">3.</strong> System requirements</a></li><li class="chapter-item expanded "><a href="preparation.html"><strong aria-hidden="true">4.</strong> Mainnet checklist</a></li><li class="chapter-item expanded affix "><li class="part-title">Quickstart</li><li class="chapter-item expanded "><a href="quick-start.html"><strong aria-hidden="true">5.</strong> Run the beacon node</a></li><li class="chapter-item expanded "><a href="run-a-validator.html"><strong aria-hidden="true">6.</strong> Run a validator</a></li><li class="chapter-item expanded "><a href="kiln.html"><strong aria-hidden="true">7.</strong> Run Kiln</a></li><li class="chapter-item expanded affix "><li class="part-title">How-to (beacon node)</li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">8.</strong> Install dependencies</a></li><li class="chapter-item expanded "><a href="build.html"><strong aria-hidden="true">9.</strong> Build the beacon node</a></li><li class="chapter-item expanded "><a href="start-syncing.html"><strong aria-hidden="true">10.</strong> Sync from scratch</a></li><li class="chapter-item expanded "><a href="trusted-node-sync.html"><strong aria-hidden="true">11.</strong> Sync from a trusted node (checkpoint sync)</a></li><li class="chapter-item expanded "><a href="web3-backup.html"><strong aria-hidden="true">12.</strong> Add a backup web3 provider</a></li><li class="chapter-item expanded affix "><li class="part-title">How-to (validator)</li><li class="chapter-item expanded "><a href="deposit.html"><strong aria-hidden="true">13.</strong> Make a deposit</a></li><li class="chapter-item expanded "><a href="keys.html"><strong aria-hidden="true">14.</strong> Import your validator keys</a></li><li class="chapter-item expanded "><a href="connect-eth2.html"><strong aria-hidden="true">15.</strong> Connect your validator to eth2</a></li><li class="chapter-item expanded "><a href="keep-an-eye.html"><strong aria-hidden="true">16.</strong> Keep an eye on your validator</a></li><li class="chapter-item expanded "><a href="more-keys.html"><strong aria-hidden="true">17.</strong> Recover / generate keys</a></li><li class="chapter-item expanded "><a href="voluntary-exit.html"><strong aria-hidden="true">18.</strong> Perform a voluntary exit</a></li><li class="chapter-item expanded "><a href="additional-validator.html"><strong aria-hidden="true">19.</strong> Add an additional validator</a></li><li class="chapter-item expanded "><a href="attestation-performance.html"><strong aria-hidden="true">20.</strong> Monitor attestation performance</a></li><li class="chapter-item expanded "><a href="validator-monitor.html"><strong aria-hidden="true">21.</strong> Monitor specific validators</a></li><li class="chapter-item expanded affix "><li class="part-title">How-to (misc)</li><li class="chapter-item expanded "><a href="keep-updated.html"><strong aria-hidden="true">22.</strong> Upgrade / downgrade Nimbus</a></li><li class="chapter-item expanded "><a href="eth1.html"><strong aria-hidden="true">23.</strong> Run an Execution layer node</a></li><li class="chapter-item expanded "><a href="goerli-eth.html"><strong aria-hidden="true">24.</strong> Obtain Goerli ETH</a></li><li class="chapter-item expanded "><a href="beacon-node-systemd.html"><strong aria-hidden="true">25.</strong> Set up a systemd service</a></li><li class="chapter-item expanded "><a href="log-rotate.html"><strong aria-hidden="true">26.</strong> Set up log rotation</a></li><li class="chapter-item expanded "><a href="checksums.html"><strong aria-hidden="true">27.</strong> Verify the integrity of Nimbus</a></li><li class="chapter-item expanded "><a href="database-backup.html"><strong aria-hidden="true">28.</strong> Back up your database</a></li><li class="chapter-item expanded "><a href="logging.html"><strong aria-hidden="true">29.</strong> Set up logging</a></li><li class="chapter-item expanded "><a href="email-notifications.html"><strong aria-hidden="true">30.</strong> Set up email notifications</a></li><li class="chapter-item expanded "><a href="graffiti.html"><strong aria-hidden="true">31.</strong> Graffiti the blockchain</a></li><li class="chapter-item expanded "><a href="profits.html"><strong aria-hidden="true">32.</strong> Optimise for profitability</a></li><li class="chapter-item expanded "><a href="health.html"><strong aria-hidden="true">33.</strong> Monitor the health of your node</a></li><li class="chapter-item expanded "><a href="networking.html" class="active"><strong aria-hidden="true">34.</strong> Networking</a></li><li class="chapter-item expanded affix "><li class="part-title">Guides</li><li class="chapter-item expanded "><a href="metrics-pretty-pictures.html"><strong aria-hidden="true">35.</strong> Grafana and Prometheus</a></li><li class="chapter-item expanded "><a href="infura-guide.html"><strong aria-hidden="true">36.</strong> Create your own Infura endpoint</a></li><li class="chapter-item expanded "><a href="migration.html"><strong aria-hidden="true">37.</strong> Migrate from another client</a></li><li class="chapter-item expanded "><a href="pi-guide.html"><strong aria-hidden="true">38.</strong> Validate with a Raspberry Pi</a></li><li class="chapter-item expanded affix "><li class="part-title">Security</li><li class="chapter-item expanded "><a href="security_issues.html"><strong aria-hidden="true">39.</strong> Security Issues / Responsible Disclosure</a></li><li class="chapter-item expanded "><a href="audit.html"><strong aria-hidden="true">40.</strong> Security Audit</a></li><li class="chapter-item expanded "><a href="distribution_internals.html"><strong aria-hidden="true">41.</strong> Reproducible Builds</a></li><li class="chapter-item expanded affix "><li class="part-title">Downloads</li><li class="chapter-item expanded "><a href="binaries.html"><strong aria-hidden="true">42.</strong> Download binaries</a></li><li class="chapter-item expanded "><a href="docker.html"><strong aria-hidden="true">43.</strong> Download Docker images</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference</li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">44.</strong> JSON-RPC API</a></li><li class="chapter-item expanded "><a href="rest-api.html"><strong aria-hidden="true">45.</strong> REST API</a></li><li class="chapter-item expanded "><a href="keymanager-api.html"><strong aria-hidden="true">46.</strong> Keymanager API</a></li><li class="chapter-item expanded "><a href="options.html"><strong aria-hidden="true">47.</strong> Help / Command line options</a></li><li class="chapter-item expanded "><a href="migration-options.html"><strong aria-hidden="true">48.</strong> Advanced migration options</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">49.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="developers.html"><strong aria-hidden="true">50.</strong> For developers</a></li><li class="chapter-item expanded "><a href="contribute.html"><strong aria-hidden="true">51.</strong> Contribute</a></li><li class="chapter-item expanded "><a href="resources.html"><strong aria-hidden="true">52.</strong> Resources</a></li><li class="chapter-item expanded "><a href="prater.html"><strong aria-hidden="true">53.</strong> Prater testnet</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">54.</strong> FAQ</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Nimbus Beacon Chain Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/status-im/nimbus-eth2" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="network-setup"><a class="header" href="#network-setup">Network setup</a></h1>
<p>Nimbus will automatically connect to peers based on the health and quality of peers that it's already connected to. Depending on the network and the number of validators attached to the node, Nimbus may need anywhere from 10 to 60 peers connected to operate well.</p>
<p>In addition to making outgoing connections, the beacon node node works best when others can connect to it - this speeds up the process of finding good peers.</p>
<p>To allow incoming connections, the node must be reachable via a public IP address. It must also be aware of this address, so that it can advertise it to its peers.</p>
<h2 id="upnp"><a class="header" href="#upnp">UPnP</a></h2>
<p>By default, Nimbus uses <a href="https://en.wikipedia.org/wiki/Universal_Plug_and_Play">UPnP</a> to set up port forwarding and detect your external IP address. If you do not have UPnP enabled, you may need to pass additional command-line options to the node, as explained in subsequent sections.</p>
<p>Enabling UPnP is usually as simple as checking a box in your router's configuration. Unless it's a FRITZ!Box router, that is.</p>
<p>With this brand, you will also need to edit individual connections - in &quot;Home Network&quot; -&gt; &quot;Network&quot; -&gt; edit icon -&gt; &quot;Permit independent port sharing for this device&quot;. You might also want to enable &quot;Always assign this network device the same IPv4 address&quot;, in case the setting is associated with IPs instead of MACs.</p>
<h2 id="monitor-your-peer-count"><a class="header" href="#monitor-your-peer-count">Monitor your Peer count</a></h2>
<blockquote>
<p><strong>Note:</strong> As of <code>v1.7.0</code>, peer scoring has been fine-tuned. As such <code>--max-peers</code> should not be set below 70. Note that Lowering <code>max-peers</code> does not significantly improve bandwidth usage, but does increase the risk of missed attestations.</p>
</blockquote>
<p>If your Peer count is low (less than <code>15</code>) and/or you repeatedly see either of the following warnings:</p>
<p><code>Peer count low, no new peers discovered...</code></p>
<p>or</p>
<p><code>No peers for topic, skipping publish...</code></p>
<p>It means that Nimbus is unable to find a sufficient number of peers to guarantee stable operation, and you may miss attestations and blocks as a result.</p>
<p>Most commonly, this happens when your computer is not reachable from the outside and therefore won't be able to accept any incoming peer connections.</p>
<p>If you're on a home network, the fix here is to <a href="./networking.html#set-up-port-forwarding">set up port forwarding</a> (this may require you to <a href="./networking.html#pass-the-extip-option">pass the extip option</a> and <a href="./networking.html#set-enr-auto-update">set enr-auto-update</a>).</p>
<p>The first step however, is to check for incoming connections.</p>
<h2 id="check-for-incoming-connections"><a class="header" href="#check-for-incoming-connections">Check for incoming connections</a></h2>
<p>To check if you have incoming connections set, run:</p>
<pre><code>curl -s http://localhost:8008/metrics | grep libp2p_open_streams
</code></pre>
<p>In the output, look for a line that looks like:</p>
<pre><code>libp2p_open_streams{type=&quot;ChronosStream&quot;,dir=&quot;in&quot;}
</code></pre>
<p>If there are no <code>dir=in</code> ChronosStreams , incoming connections are not working.</p>
<blockquote>
<p><strong>N.B</strong> you need to run the client with the <code>--metrics</code> option enabled in order for this to work</p>
</blockquote>
<h2 id="pass-the-extip-option"><a class="header" href="#pass-the-extip-option">Pass the extip option</a></h2>
<p>If you have a static public IP address, use the <code>--nat:extip:$EXT_IP_ADDRESS</code> option to pass it to the client,  where <code>$EXT_IP_ADDRESS</code> is your public IP (see <a href="./networking.html#determine-your-public-ip-address">here</a> for how to determine your public IP address). For example, if your public IP address is <code>1.2.3.4</code>, you'd run:</p>
<pre><code>./run-prater-beacon-node.sh --nat:extip:1.2.3.4
</code></pre>
<blockquote>
<p>Note that this should also work with a dynamic IP address. But you will probably also need to pass <code>enr-auto-update</code> as an option to the client.</p>
</blockquote>
<h2 id="set-enr-auto-update"><a class="header" href="#set-enr-auto-update">Set ENR auto update</a></h2>
<p>The <code>--enr-auto-update</code> feature keeps your external IP address up to date based on information received from other peers on the network. This option is useful with ISPs that assign IP addresses dynamically.</p>
<p>In practice this means relaunching the beacon node with <code>--enr-auto-update:true</code> (pass it as an option in the command line).</p>
<h2 id="set-up-port-forwarding"><a class="header" href="#set-up-port-forwarding">Set up port forwarding</a></h2>
<p>If you're running on a home network and want to ensure you are able to receive incoming connections you may need to set up port forwarding (though some routers automagically set this up for you).</p>
<blockquote>
<p><strong>Note:</strong> If you are running your node on a virtual public server (VPS) instance, you can safely ignore this section.</p>
</blockquote>
<p>While the specific steps required vary based on your router, they can be summarised as follows:</p>
<ol>
<li>Determine your <a href="./networking.html#determine-your-public-ip-address">public IP address</a></li>
<li>Determine your <a href="./networking.html#determine-your-private-ip-address">private IP address</a></li>
<li>Browse to the management website for your home router (<a href="http://192.168.1.1">http://192.168.1.1</a> for most routers, <a href="https://192.168.178.1">https://192.168.178.1</a> for FRITZ!Box)</li>
<li>Log in as admin</li>
<li>Find the section to configure port forwarding</li>
<li>Configure a port forwarding rule with the following values:</li>
</ol>
<ul>
<li>External port: <code>9000</code></li>
<li>Internal port: <code>9000</code></li>
<li>Protocol: <code>TCP</code></li>
<li>IP Address: Private IP address of the computer running Nimbus</li>
</ul>
<ol start="7">
<li>Configure a second port forwarding rule with the following values:</li>
</ol>
<ul>
<li>External port: <code>9000</code></li>
<li>Internal port: <code>9000</code></li>
<li>Protocol: <code>UDP</code></li>
<li>IP Address: Private IP address of the computer running Nimbus</li>
</ul>
<h3 id="determine-your-public-ip-address"><a class="header" href="#determine-your-public-ip-address">Determine your public IP address</a></h3>
<p>To determine your public IP address, visit <a href="http://v4.ident.me/">http://v4.ident.me/</a> or run this command:</p>
<pre><code>curl v4.ident.me
</code></pre>
<h3 id="determine-your-private-ip-address"><a class="header" href="#determine-your-private-ip-address">Determine your private IP address</a></h3>
<p>To determine your private IP address, run the appropriate command for your OS:</p>
<p><strong>Linux:</strong></p>
<pre><code>ip addr show | grep &quot;inet &quot; | grep -v 127.0.0.1
</code></pre>
<p><strong>Windows:</strong></p>
<pre><code>ipconfig | findstr /i &quot;IPv4 Address&quot;
</code></pre>
<p><strong>macOS:</strong></p>
<pre><code>ifconfig | grep &quot;inet &quot; | grep -v 127.0.0.1
</code></pre>
<h2 id="check-open-ports-on-your-connection"><a class="header" href="#check-open-ports-on-your-connection">Check open ports on your connection</a></h2>
<p>Use <a href="https://www.yougetsignal.com/tools/open-ports/">this tool</a> to check your external (public) IP address and detect open ports on your connection (Nimbus TCP and UDP ports are both set to <code>9000</code> by default).</p>
<h2 id="reading-the-logs"><a class="header" href="#reading-the-logs">Reading the logs</a></h2>
<p><code>No peers for topic, skipping publish...</code></p>
<p>This is printed when the client lacks quality peers to publish attestations to - this is the most important indication that the node is having trouble keeping up. If you see this, you are missing attestations.</p>
<p><code>Peer count low, no new peers discovered...</code></p>
<p>This is a sign that you may be missing attestations.</p>
<p><code>No external IP provided for the ENR...</code></p>
<p>This message basically means that the software did not manage to find a public IP address (by either looking at your routed interface IP address, and/or by attempting to get it from your gateway through UPnP or NAT-PMP).</p>
<p><code>Discovered new external address but ENR auto update is off...</code></p>
<p>It's possible that your ISP has changed your IP address without you knowing. The first thing to do it to try relaunching the beacon node with with <code>--enr-auto-update:true</code> (pass it as an option in the command line).</p>
<p>If this doesn't fix the problem, the next thing to do is to check your external (public) IP address and detect open ports on your connection - you can use <a href="https://www.yougetsignal.com/tools/open-ports/">this site</a>.  Note that Nimbus <code>TCP</code> and <code>UDP</code> ports are both set to <code>9000</code> by default. See above for how to set up port forwarding.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/status-im/nimbus-eth2/edit/unstable/docs/the_nimbus_book/src/networking.md">Edit this file on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="health.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="metrics-pretty-pictures.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="health.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="metrics-pretty-pictures.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
